<!doctype html>
<html lang='ru'>
<head>
  <meta charset='utf-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>MentorMatch — админка (MVP)</title>
  <style>
    body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; margin: 20px; line-height: 1.4; }
    h1 { margin-bottom: 0.2rem; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; }
    .card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; box-shadow: 0 2px 6px rgba(0,0,0,.04); }
    label { display:block; font-size:0.9rem; margin-bottom:6px; }
    input[type='text'], input[type='number'], textarea, select {
      width: 100%; padding: 8px 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px;
    }
    textarea { min-height: 80px; }
    button { background: #2563eb; color: white; border: 0; padding: 10px 14px; border-radius: 8px; cursor: pointer; }
    button:hover { background: #1e40af; }
    .muted { color: #64748b; font-size: 0.9rem; }
    .list { margin-top: 8px; }
    .item { padding: 6px 0; border-bottom: 1px dashed #e5e7eb; }
    .tabs a { margin-right: 8px; text-decoration:none; color:#0f172a; padding:6px 10px; border:1px solid #e2e8f0; border-radius:8px; }
    .tabs a.active { background:#0f172a; color:#fff; }
    .msg { padding: 10px 12px; border-radius: 8px; background: #ecfeff; border: 1px solid #a5f3fc; margin-bottom: 12px; }
    .row { display:flex; gap: 12px; align-items:center; }
  </style>
</head>
<body>
  <h1>MentorMatch — админка (MVP)</h1>
  <p class='muted'>Импорт из Google Sheets, добавление научных руководителей и тем, просмотр последних записей и заглушка подбора.</p>

  {% if msg %}<div class='msg'>{{ msg }}</div>{% endif %}

  <div class='grid'>
    <div class='card'>
      <h3>Обновить данные из Google Sheets</h3>
      <form method='post' action='/import-sheet'>
        <label>Spreadsheet ID
          <input type='text' name='spreadsheet_id' value='{{ env_spreadsheet_id }}' required />
        </label>
        <label>Sheet name (опц.)
          <input type='text' name='sheet_name' placeholder='если пусто — берётся первый лист' />
        </label>
        <button type='submit'>Импортировать</button>
      </form>
    </div>

    <div class='card'>
      <h3>Добавить научного руководителя</h3>
      <form method='post' action='/add-supervisor'>
        <label>ФИО <input type='text' name='full_name' required></label>
        <label>Email <input type='text' name='email'></label>
        <label>Username (tg) <input type='text' name='username'></label>
        <label>Должность <input type='text' name='position'></label>
        <label>Учёная степень <input type='text' name='degree'></label>
        <label>Лимит студентов <input type='number' name='capacity' min='0'></label>
        <label>Требования <textarea name='requirements'></textarea></label>
        <label>Интересы <textarea name='interests'></textarea></label>
        <button type='submit'>Сохранить научного руководителя</button>
      </form>
    </div>

    <div class='card'>
      <h3>Добавить тему</h3>
      <form method='post' action='/add-topic'>
        <label>Заголовок <input type='text' name='title' required></label>
        <label>Автор (user_id) <input type='number' name='author_user_id' placeholder='опционально'></label>
        <label>Автор (ФИО) <input type='text' name='author_full_name' placeholder='если нет user_id'></label>
        <label>Описание <textarea name='description'></textarea></label>
        <label>Ожидаемые результаты <textarea name='expected_outcomes'></textarea></label>
        <label>Требуемые навыки <input type='text' name='required_skills' placeholder='через запятую'></label>
        <label>Кого ищем
          <select name='seeking_role'>
            <option value='student'>student</option>
            <option value='supervisor'>supervisor</option>
          </select>
        </label>
        <button type='submit'>Добавить тему</button>
      </form>
    </div>
  </div>

  <div class='card' style='margin-top:16px;'>
    <h3>Последние записи (10 шт.)</h3>
    <form class='row' method='get' action='/'>
      <label>Тип
        <select name='kind'>
          <option value='topics' {{ 'selected' if kind=='topics' else '' }}>Темы</option>
          <option value='students' {{ 'selected' if kind=='students' else '' }}>Студенты</option>
          <option value='supervisors' {{ 'selected' if kind=='supervisors' else '' }}>Научные руководители</option>
        </select>
      </label>
      <label>Смещение (offset)
        <input type='number' name='offset' min='0' value='{{ offset or 0 }}' />
      </label>
      <button type='submit'>Показать</button>
    </form>
    <div class='tabs' style='margin-top:10px;'>
      <a href='/?kind=topics' class='{{ 'active' if kind=='topics' else '' }}'>Темы</a>
      <a href='/?kind=students' class='{{ 'active' if kind=='students' else '' }}'>Студенты</a>
      <a href='/?kind=supervisors' class='{{ 'active' if kind=='supervisors' else '' }}'>Научные руководители</a>
    </div>
    <div class='list'>
      {% if kind == 'topics' %}
        {% for it in items %}
          <div class='item'><strong>#{{ it.id }}</strong> — {{ it.title }} <span class='muted'>({{ it.seeking_role }})</span> — автор: {{ it.author }} — {{ it.created_at }}</div>
        {% endfor %}
      {% elif kind == 'students' %}
        {% for it in items %}
          <div class='item'><strong>#{{ it.id }}</strong> — {{ it.full_name }} <span class='muted'>program: {{ it.program or '-' }}</span> — {{ it.created_at }}</div>
        {% endfor %}
      {% else %}
        {% for it in items %}
          <div class='item'><strong>#{{ it.id }}</strong> — {{ it.full_name }} <span class='muted'>{{ it.position or '-' }}, {{ it.degree or '-' }}</span> — cap: {{ it.capacity or 0 }} — {{ it.created_at }}</div>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  <div class='card' style='margin-top:16px;'>
    <h3>Подобрать человека под тему (заглушка)</h3>
    <form method='post' action='/match-topic'>
      <label>Topic ID <input type='number' name='topic_id' required></label>
      <label>Кого ищем
        <select name='target_role'>
          <option value='student'>student</option>
          <option value='supervisor'>supervisor</option>
        </select>
      </label>
      <button type='submit'>Подобрать</button>
    </form>
    <p class='muted'>Пока возвращает заготовку JSON; позже подключим скоринг/LLM.</p>
    <p class='muted'>JSON API: <code>/latest?kind=topics&offset=0</code></p>
  </div>
  <div class="card" style="margin-top:16px;">
    <h3>????????? ???? ??? ???????? (LLM/??????)</h3>
    <form method="post" action="/match-student">
      <label>Student user_id <input type="number" name="student_user_id" required></label>
      <button type="submit">????????? ????</button>
    </form>
    <p class="muted">???? ????? ???????? ???, ??? ????? ??????? (seeking_role=student).</p>
  </div></body>
</html>
